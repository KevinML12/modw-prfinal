# Usamos una imagen de Node que ya incluye pnpm
FROM node:18-slim

# Activamos pnpm
RUN corepack enable

# Establecemos el directorio de trabajo
WORKDIR /app

# Configuramos pnpm store location ANTES de instalar
RUN pnpm config set store-dir /app/.pnpm-store

# Copiamos package.json primero
COPY package.json ./

# Copiamos pnpm-lock.yaml si existe (opcional)
COPY pnpm-lock.yaml* ./

# Copiamos .npmrc si existe
COPY .npmrc* ./

# Instalamos las dependencias
# Si no hay lock file, pnpm lo generar√°
RUN pnpm install

# Exponemos el puerto del servidor de desarrollo de Vite
EXPOSE 5173

# El comando para iniciar el servidor de desarrollo.
# El flag '--host' es CRUCIAL para que sea accesible desde fuera del contenedor.
CMD ["pnpm", "run", "dev", "--host"]