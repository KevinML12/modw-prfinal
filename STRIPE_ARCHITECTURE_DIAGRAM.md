# ARQUITECTURA - STRIPE PAYMENT INTEGRATION BLOQUE 1

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MODA ORGÃNICA                                â”‚
â”‚                   E-Commerce JoyerÃ­a Artesanal                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            CHECKOUT FLOW
                            
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FRONTEND (SvelteKit)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  /checkout Route                                                     â”‚
â”‚  â”œâ”€ TextInput (Email, Name, Phone)                                   â”‚
â”‚  â”œâ”€ LocationSelector (Department, Municipality, Address)             â”‚
â”‚  â”œâ”€ Cart Summary (Items, Subtotal, Shipping)                        â”‚
â”‚  â””â”€ Button: "Pagar Ahora" â†’ handleSubmit()                          â”‚
â”‚                                                                       â”‚
â”‚  handleSubmit()                                                      â”‚
â”‚  â”œâ”€ Validar formulario                                               â”‚
â”‚  â”œâ”€ Construir payload                                                â”‚
â”‚  â”œâ”€ POST /api/v1/payments/create-checkout-session                   â”‚
â”‚  â””â”€ window.location.href = data.checkout_url                        â”‚
â”‚                                                                       â”‚
â”‚  Success Page (/checkout/success?session_id=...)                     â”‚
â”‚  â”œâ”€ Obtener session_id de URL                                        â”‚
â”‚  â”œâ”€ Limpiar carrito con cart.clear()                                â”‚
â”‚  â”œâ”€ Mostrar confirmaciÃ³n âœ“                                           â”‚
â”‚  â””â”€ BotÃ³n: Volver a tienda                                           â”‚
â”‚                                                                       â”‚
â”‚  Cancel Page (/checkout/cancel)                                      â”‚
â”‚  â”œâ”€ Mostrar aviso de cancelaciÃ³n                                     â”‚
â”‚  â”œâ”€ Mantener carrito intacto                                         â”‚
â”‚  â””â”€ Botones: Volver a checkout o Seguir comprando                   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND API (Go + Gin)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  POST /api/v1/payments/create-checkout-session                       â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ PaymentController.CreateCheckoutSession()                        â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ 1. Validar Input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â”‚   â””â”€ Bind JSON & Validate                                         â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ 2. Crear Orden â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  â”‚   â”œâ”€ Instantiate models.Order                                     â”‚
â”‚  â”‚   â”œâ”€ Llenar CustomerEmail, CustomerName, CustomerPhone           â”‚
â”‚  â”‚   â”œâ”€ Llenar ShippingDepartment, Municipality, Address             â”‚
â”‚  â”‚   â”œâ”€ Llenar Subtotal, ShippingCost, Total                        â”‚
â”‚  â”‚   â”œâ”€ Status = "pending"                                           â”‚
â”‚  â”‚   â””â”€ db.GormDB.Create(&order)                                    â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ 3. Crear Order Items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚   â”œâ”€ Loop items[]                                                 â”‚
â”‚  â”‚   â”œâ”€ Instantiate models.OrderItem                                 â”‚
â”‚  â”‚   â”œâ”€ ProductID, Quantity, Price                                   â”‚
â”‚  â”‚   â””â”€ db.GormDB.Create(&orderItem)                               â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ 4. Configurar Stripe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚   â””â”€ stripe.Key = os.Getenv("STRIPE_SECRET_KEY")                â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ 5. Crear Line Items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚   â”œâ”€ Loop items[] â†’ stripe.CheckoutSessionLineItemParams         â”‚
â”‚  â”‚   â”œâ”€ Convertir precios a centavos (* 100)                         â”‚
â”‚  â”‚   â”œâ”€ Agregar shipping como line item                              â”‚
â”‚  â”‚   â””â”€ Retorna []*stripe.CheckoutSessionLineItemParams             â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ 6. Construir URLs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚   â”œâ”€ successURL = FRONTEND_URL/checkout/success?session_id={...} â”‚
â”‚  â”‚   â””â”€ cancelURL = FRONTEND_URL/checkout/cancel                    â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ 7. Crear Session â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â”‚   â”œâ”€ stripe.CheckoutSessionParams                                 â”‚
â”‚  â”‚   â”œâ”€ PaymentMethodTypes: "card"                                   â”‚
â”‚  â”‚   â”œâ”€ Mode: "payment"                                              â”‚
â”‚  â”‚   â”œâ”€ Metadata: order_id, customer_email, customer_name            â”‚
â”‚  â”‚   â”œâ”€ CustomerEmail                                                â”‚
â”‚  â”‚   â”œâ”€ BillingAddressCollection: "auto"                            â”‚
â”‚  â”‚   â”œâ”€ AllowPromotionCodes: false                                   â”‚
â”‚  â”‚   â””â”€ session.New(params)                                          â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â”œâ”€ 8. Actualizar Orden â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚   â”œâ”€ order.PaymentIntentID = sess.ID                              â”‚
â”‚  â”‚   â””â”€ db.GormDB.Save(&order)                                      â”‚
â”‚  â”‚                                                                    â”‚
â”‚  â””â”€ 9. Retornar Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚      â”œâ”€ checkout_url: sess.URL                                       â”‚
â”‚      â”œâ”€ session_id: sess.ID                                          â”‚
â”‚      â””â”€ order_id: order.ID                                           â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STRIPE CHECKOUT (Hosted)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  Checkout Form                                                       â”‚
â”‚  â”œâ”€ Email: test@example.com                                          â”‚
â”‚  â”œâ”€ Card: 4242 4242 4242 4242                                       â”‚
â”‚  â”œâ”€ Exp: 12/25                                                       â”‚
â”‚  â”œâ”€ CVC: 123                                                         â”‚
â”‚  â””â”€ Button: "Pay"                                                    â”‚
â”‚                                                                       â”‚
â”‚  Success â†’ Redirige a successURL                                     â”‚
â”‚  Cancel  â†’ Redirige a cancelURL                                      â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE (Supabase)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  Orders Table                                                        â”‚
â”‚  â”œâ”€ id: INT (PK)                                                     â”‚
â”‚  â”œâ”€ user_id: INT (FK) - NULL para guest checkout                     â”‚
â”‚  â”œâ”€ customer_email: VARCHAR                                          â”‚
â”‚  â”œâ”€ customer_name: VARCHAR                                           â”‚
â”‚  â”œâ”€ customer_phone: VARCHAR                                          â”‚
â”‚  â”œâ”€ shipping_department: VARCHAR                                     â”‚
â”‚  â”œâ”€ shipping_municipality: VARCHAR                                   â”‚
â”‚  â”œâ”€ shipping_address: VARCHAR                                        â”‚
â”‚  â”œâ”€ subtotal: DECIMAL                                                â”‚
â”‚  â”œâ”€ shipping_cost: DECIMAL                                           â”‚
â”‚  â”œâ”€ total: DECIMAL                                                   â”‚
â”‚  â”œâ”€ status: VARCHAR ('pending', 'paid', 'shipped', etc.)            â”‚
â”‚  â”œâ”€ payment_intent_id: VARCHAR (Stripe session ID)                  â”‚
â”‚  â””â”€ created_at: TIMESTAMP                                            â”‚
â”‚                                                                       â”‚
â”‚  Order Items Table                                                   â”‚
â”‚  â”œâ”€ id: INT (PK)                                                     â”‚
â”‚  â”œâ”€ order_id: INT (FK)                                               â”‚
â”‚  â”œâ”€ product_id: INT (FK)                                             â”‚
â”‚  â”œâ”€ quantity: INT                                                    â”‚
â”‚  â”œâ”€ price: DECIMAL                                                   â”‚
â”‚  â””â”€ created_at: TIMESTAMP                                            â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DATA FLOW DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User     â”‚
â”‚  Browser   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Fill checkout form
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Checkout Page     â”‚
â”‚  handleSubmit()    â”‚
â”‚  Validate          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. POST JSON payload
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend API                             â”‚
â”‚  /api/v1/payments/create-checkout-sessionâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Validate & Create DB records
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Database                       â”‚
â”‚  - Create Order (pending)                â”‚
â”‚  - Create OrderItems                     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Create Stripe Session
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stripe API                              â”‚
â”‚  /v1/checkout/sessions                   â”‚
â”‚  Returns: session.URL, session.ID        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. Return checkout_url to frontend
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend          â”‚
â”‚  Redirect to       â”‚
â”‚  Stripe Checkout   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. window.location.href = checkout_url
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stripe Checkout (Hosted)               â”‚
â”‚  User pays with card                    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 7a. Success OR 7b. Cancel
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7a. Redirect to         â”‚  7b. Redirect to         â”‚
â”‚  /checkout/success       â”‚  /checkout/cancel        â”‚
â”‚  ?session_id={ID}        â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚
       â”‚                          â”‚ Keep cart
       â”‚ Clear cart               â”‚
       â”‚                          â”‚
       â†“                          â†“
     Success                    Cancel
     Page                       Page
```

---

## ğŸ”„ State Changes

```
Order Status Transitions:

pending â”€â”€[Payment Success]â”€â”€> paid
    â†‘         (Webhook)           â”‚
    â”‚                              â”‚
    â”‚                              â†“
    â”‚                         shipped
    â”‚                              â”‚
    â””â”€â”€[Refund/Cancel]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ENVIRONMENT VARIABLES

```
STRIPE_SECRET_KEY        â†’ Backend authentication with Stripe API
STRIPE_PUBLISHABLE_KEY   â†’ Frontend (for future use with Stripe.js)
STRIPE_WEBHOOK_SECRET    â†’ Webhook verification (BLOQUE 2)
FRONTEND_URL             â†’ For success/cancel redirects
```

---

## ğŸ¯ KEY FEATURES

- âœ… Guest Checkout (sin requerimiento de login)
- âœ… Guest Validation (email, phone, address)
- âœ… Real-time Shipping Cost Calculation
- âœ… Order & OrderItems Creation
- âœ… Stripe Integration (Checkout Sessions)
- âœ… Success & Cancel Pages
- âœ… Cart Cleanup on Success
- âœ… Metadata Tracking (order_id in Stripe)

---

## ğŸ” SECURITY MEASURES

- âœ… Secret key never exposed to frontend
- âœ… All validation on backend
- âœ… Stripe PCI compliance handled
- âœ… HTTPS enforced in production
- âœ… CORS configured appropriately
- âœ… Environment variables for secrets

---

**ARCHITECTURE COMPLETE** - Ready for webhook integration (BLOQUE 2)
